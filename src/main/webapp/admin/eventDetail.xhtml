<ui:composition
     xmlns="http://www.w3.org/1999/xhtml"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:p="http://primefaces.org/ui"
     xmlns:b="http://bootsfaces.net/ui"
     template="/WEB-INF/templates/dashboard-layout.xhtml"
     >
     <ui:define name="content">

					<h1>Event</h1>
                    <hr/>
					
					<h:form >
     				<b:commandButton ajax="true" update="eventImagePanel" process="@this" immediate="true" style="visibility:hidden" id="emptyAction" styleClass="refreshImagePanel"/>
				    <b:panel>
					   <f:facet name="heading">
					     <i class="fa fa-calendar-o" style="padding-right:20px" />
					     <h:outputText value="Event detail" />
					   </f:facet>




						<b:row >
				    			<b:column col-md="8" col-xs="12">
					    			<b:panelGrid columns="1">
								   		<b:inputText value="#{eventBean.event.name}" label="Event Name" render-label="true" required="true" >
								   		</b:inputText>
								    </b:panelGrid>					   
			
								    <b:panelGrid columns="2">
									    <b:dateTimePicker value="#{eventBean.event.dateFrom}"
									        icon-position="right"
									        show-date="true"
									        show-time="false"
									        show-icon="true" 
									        label="Date from" 
									        required="true"
									        update="datePanel"
									        process="@this"									        
									        />
								    <b:dateTimePicker value="#{eventBean.event.dateTo}"
								        icon-position="right"
								        show-date="true"
								        show-time="false"
								        show-icon="true" 
								        label="Date to"
								        required="true"
								        update="datePanel"
								        process="@this"
								        />						        
			
								    </b:panelGrid>
								    
					    			<b:panelGrid columns="1" id="datePanel">
					    			
					    			
				    					<b:selectMultiMenu value="#{eventBean.event.daysOfWeek}" label="Days of week" >
								            <f:selectItem itemValue="1" itemLabel="Sunday"/>
								            <f:selectItem itemValue="2" itemLabel="Monday"/>
								            <f:selectItem itemValue="3" itemLabel="Tuesday"/>
								            <f:selectItem itemValue="4" itemLabel="Wednesday"/>
								            <f:selectItem itemValue="5" itemLabel="Thursday"/>
								            <f:selectItem itemValue="6" itemLabel="Friday"/>
								            <f:selectItem itemValue="7" itemLabel="Saturday"/>
								        </b:selectMultiMenu>
										 <b:selectMultiMenu value="#{eventBean.event.eventCategoryAsString}" label="Event type" >
									            <f:selectItems value="#{eventBean.event.eventCategory}"  var="cat" itemValue="#{cat.toString()}" itemLabel="#{cat.emoji} #{cat.description}"/>
									        </b:selectMultiMenu>
								    </b:panelGrid>									    
								    
								    
								    
							    
							    
				    			</b:column>
				    			<b:column col-md="4" col-xs="12">
				    				
				    			
					    			<b:panel style="min-height:150px" styleClass="overview-box-image" id="eventImagePanel">
					    				<h:panelGrid columns="1" styleClass="overview-box-image">
											<p:graphicImage value="#{eventBean.content}" height="150px"/>
											<b:button iconAwesome="photo" look="success" onclick="$('.modalPseudoClass').modal()" value="Load image" />
					    				</h:panelGrid>
					    			</b:panel>
					    			
					    			<b:image library="img" name="qr_code.jpg" height="150px" rendered="#{eventBean.event.id != null}"/>
					    			
							</b:column>
						</b:row>			
					   	<b:panelGrid columns="1">
						    <b:inputTextarea placeholder="Event description..." value="#{eventBean.event.description}" label="Event description"/>
					    </b:panelGrid>

				    	</b:panel>
				    	
				    	<b:panel>
						   <f:facet name="heading">
						     <i class="fa fa-ticket" style="padding-right:20px" />
						     <h:outputText value="Ticket Options" />
						   </f:facet>
						   
						   <b:dataTable value="#{eventBean.event.categories}" var="category"  paginated="false" class="editableCategoryTable" searching="false" id="editableCategoryTable">
						        <b:dataTableColumn>
						        	<f:facet name="header">
							          <h:outputText value="Description"/>
							        </f:facet>
							        <b:inputText value="#{category.description}" required="true" ajax="true" process="@this" update="@none"/>
						        </b:dataTableColumn>
					       		<b:dataTableColumn>
						        	<f:facet name="header">
							          <h:outputText value="Ticket Suppy" />
							        </f:facet>
						       		<h:panelGrid columns="#{category.supplyType == 'LEGACY_CODE' ? 3:1}">
							    	    <b:inputText value="#{category.ticketSupply}" required="true" mask="integer"  readonly="#{category.supplyType == 'LEGACY_CODE'}"  ajax="true" process="@this" update="@none">
								    	    <f:facet name="prepend">
									       		 <b:selectOneMenu value="#{category.supplyType}" ajax="true" process="@this" update="editableCategoryTable">
									       		 	<f:selectItem itemValue="NORMAL" itemLabel="Normal" />
									       		 	<f:selectItem itemValue="LEGACY_CODE" itemLabel="Legacy code" />
									       		 </b:selectOneMenu>
								       		 </f:facet>
							    	    </b:inputText>
						       			<b:commandButton icon="file" ajax="true" rendered="#{category.supplyType == 'LEGACY_CODE'}"  />
						       			<b:commandButton icon-awesome="times" title="Revoke unused" ajax="true" rendered="#{category.supplyType == 'LEGACY_CODE'}"  />
						       			
						       		</h:panelGrid>
						       								        
						        </b:dataTableColumn>
						        <b:dataTableColumn value="#{category.ticketSupply-category.ticketSold}" label="Available Tickets" />
				       			<b:dataTableColumn>
									<f:facet name="header">
							          <h:outputText value="Street Price"/>
							        </f:facet>
						       		 <b:inputText value="#{category.streetPrice}" required="true" mask="decimal" ajax="true">
						       		 	<f:ajax onevent="change" execute="@this" listener="#{eventBean.calculateNetPrice()}" render="editableCategoryTable"/>
							       		 <f:facet name="prepend">
								       		 <b:selectOneMenu value="#{category.currency}">
								       		 	<f:selectItem itemValue="EUR" itemLabel="EUR" />
								       		 </b:selectOneMenu>
							       		 </f:facet>
						       		 </b:inputText>
							        
						        </b:dataTableColumn>
	
	
								<b:dataTableColumn>
									<f:facet name="header">
							          <h:outputText value="Net Price"/>
							        </f:facet>
						       		 <h:outputText value="#{category.netPrice}"/>
						        </b:dataTableColumn>
						        
						        
				       			<b:dataTableColumn>
									<f:facet name="header">
							          <h:outputText value=""/>
							        </f:facet>
						       		<h:panelGroup>
						       			 <b:commandButton  icon="minus" ajax="true" action="#{eventBean.removeCategory(category)}" update="@(.editableCategoryTable)" process="editableCategoryTable" rendered="#{eventBean.event.categories.size()&gt;1}"  />
						       		</h:panelGroup>
							        
							    	<f:facet name="footer">
							          <b:commandButton value="Add"  ajax="true" action="#{eventBean.addCategory}" update="@(.editableCategoryTable)" process="editableCategoryTable"   />
							        </f:facet>
							        
						        </b:dataTableColumn>
						       </b:dataTable>
					   </b:panel>

				    	<b:panel>
						   <f:facet name="heading">
						     <i class="fa fa-tags" style="padding-right:20px" />
						     <h:outputText value="Tags" />
						   </f:facet>		
							<b:panelGrid columns="1">
							    <b:inputText value="#{eventBean.event.tagsAsString}" placeholder="Tags" tags="true" label="Tags" ajax="true" process="@this"   />
						    </b:panelGrid>
						</b:panel>					   
					   
					   <div class="text-center">
							<b:commandButton value="Save" look="primary" size="lg" action="#{eventBean.save}"   />
						</div>
				</h:form>                  
                  
				<b:modal id="imagePanel" title="Event Image" styleClass="modalPseudoClass">
				  <h:form>
				  	 <p:fileUpload 
				  	 	fileUploadListener="#{eventBean.handleImageUpload}" mode="advanced" 
				  	 	dragDropSupport="true"
                          update="messages" sizeLimit="1000000" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" oncomplete="$('.modalPseudoClass').modal('hide');$('.refreshImagePanel').click()" />
				  </h:form>
				  <f:facet name="footer">
				    <b:button value="Close" dismiss="modal" />
				    <b:button value="Ok" look="primary" dismiss="modal"  />
				  </f:facet>
				</b:modal>

</ui:define>
</ui:composition>